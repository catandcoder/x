<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="崔某人的碎碎念,通才基础上的专才"><meta name="keywords" content="mysql,golang,算法"><title>Wall Clock与Monotonic Clock | 清澄秋爽</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Wall Clock与Monotonic Clock</h1><a id="logo" href="/.">清澄秋爽</a><p class="description">苹果树下的思索者 书写是对思维的缓存</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Wall Clock与Monotonic Clock</h1><div class="post-meta"><a href="/2012/07/17/Wall-Clock与Monotonic-Clock/#comments" class="comment-count"></a><p><span class="date">Jul 17, 2012</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h2 id="墙上时钟-vs-单调时钟"><a href="#墙上时钟-vs-单调时钟" class="headerlink" title="墙上时钟 vs 单调时钟"></a>墙上时钟 vs 单调时钟</h2><p><br></p>
<ul>
<li>Wall Clock： 挂钟时间，即现实世界里我们感知到的时间，如2008-08-08 20:08:00。</li>
</ul>
<p>但对计算机而言，这个时间不一定是单调递增的。因为人觉得当前机器的时间不准，可以随意拨慢或调快。</p>
<p>也称 <code>CLOCK_REALTIME</code>，<em>壁钟时间</em></p>
<p>本质是个相对时间，一般以时间戳形式存在(即从1970.01.01 00:00:00到现在的时间)。</p>
<p>相关函数拿得的机器的系统时间，如果修改了系统时间，会改变获取到的值。</p>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/1.png" width="100%" height="100%"></p>
<p><br></p>
<ul>
<li>Monotonic Clock</li>
</ul>
<p>Monotonic即<em>单调的</em></p>
<p>也称 <code>CLOCK_MONOTONIC</code>，或 <em>逻辑时钟</em></p>
<p>是个绝对时间。表示系统(或程序)启动后流逝的时间，更改系统的时间对它没有影响。每次系统(或程序)启动时，该值都归0</p>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/2.png" width="100%" height="100%"></p>
<p><br></p>
<p>操作系统会提供这两套时间，分别对应<em>墙上时钟</em>和<em>单调时钟</em>，其中墙上时钟 因为不支持闰秒, 且可人为更改，另外这个时间是通过石英钟等来实现的，会由于温度等不可控因素导致时间发生偏移，往往会通过网络时间协议NTP来同步修正</p>
<p>所以<em>墙上时钟</em>存在较大误差，对于某些需要精准时间计算的场景是不够的。而<em>单调时钟</em>保证时间一定是单调递增的，不存在时间往回拨，在这类场景中用的更多</p>
<p><br></p>
<hr>
<p><br></p>
<h2 id="Go中两种时间的实现"><a href="#Go中两种时间的实现" class="headerlink" title="Go中两种时间的实现"></a>Go中两种时间的实现</h2><p><br></p>
<p>通过time.Now拿到的是 墙上时钟,如</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	start := time.Now()</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"当前墙上时间为："</span>, start.String())</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出: <code>当前墙上时间为： 2022-07-17 17:04:48.734903 +0800 CST m=+0.000060084</code></p>
<p>而如果修改系统时间后再执行：</p>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/3.png" width="100%" height="100%"></p>
<p>输出: <code>当前墙上时间为： 2008-08-08 20:08:03.598384 +0800 CST m=+0.000205376</code></p>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/4.png" width="100%" height="100%"></p>
<p><br></p>
<p>修改上面代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	start := time.Now()</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"start："</span>, start.Unix())</span><br><span class="line">	fmt.Println(<span class="string">"当前墙上时间为："</span>, start.String())</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">10e9</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"在此期间修改系统时间"</span>)</span><br><span class="line"></span><br><span class="line">	end := time.Now()</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"end："</span>, end.Unix())</span><br><span class="line">	fmt.Println(<span class="string">"修改系统时间后的墙上时间为："</span>, end.String())</span><br><span class="line"></span><br><span class="line">	elapsed := end.Sub(start)</span><br><span class="line"></span><br><span class="line">	fmt.Println(elapsed)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/5.png" width="100%" height="100%"></p>
<p>发现修改系统时间后，第二次打印当前时间戳，确实“回到了过去”。但奇怪的是<code>end.Sub(start)</code>的结果居然是正确的，而不是负数</p>
<p>看一下<a href="https://pkg.go.dev/time@go1.18.4" target="_blank" rel="noopener">具体实现</a>：</p>
<p><br></p>
<h3 id="Time结构体"><a href="#Time结构体" class="headerlink" title="Time结构体"></a>Time结构体</h3><p><br></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Time <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// wall and ext encode the wall time seconds, wall time nanoseconds,</span></span><br><span class="line">	<span class="comment">// and optional monotonic clock reading in nanoseconds.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// From high to low bit position, wall encodes a 1-bit flag (hasMonotonic),</span></span><br><span class="line">	<span class="comment">// a 33-bit seconds field, and a 30-bit wall time nanoseconds field.</span></span><br><span class="line">	<span class="comment">// The nanoseconds field is in the range [0, 999999999].</span></span><br><span class="line">	<span class="comment">// If the hasMonotonic bit is 0, then the 33-bit field must be zero</span></span><br><span class="line">	<span class="comment">// and the full signed 64-bit wall seconds since Jan 1 year 1 is stored in ext.</span></span><br><span class="line">	<span class="comment">// If the hasMonotonic bit is 1, then the 33-bit field holds a 33-bit</span></span><br><span class="line">	<span class="comment">// unsigned wall seconds since Jan 1 year 1885, and ext holds a</span></span><br><span class="line">	<span class="comment">// signed 64-bit monotonic clock reading, nanoseconds since process start.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//  wall 和 ext 对 wall time seconds、wall time nanoseconds 和可选的以 nanoseconds 为单位的单调时钟读数进行编码。 从高位到低位位置，wall 编码一个 1 位标志（hasMonotonic）、一个 33 位秒字段和一个 30 位壁时间纳秒字段。纳秒字段在 [0, 999999999] 范围内。</span></span><br><span class="line">    <span class="comment">// 如果 hasMonotonic 位为 0，则 33 位字段必须为零，并且自第 1 年 1 月 1 日以来的完整有符号 64 位墙秒存储在 ext。 如果 hasMonotonic 位为 1，则 33 位字段保存自 1885 年 1 月 1 日以来的 33 位无符号壁秒，而 ext 保存自进程开始以来的有符号 64 位单调时钟读数，纳秒。</span></span><br><span class="line"></span><br><span class="line">	wall <span class="keyword">uint64</span></span><br><span class="line">	ext  <span class="keyword">int64</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// loc specifies the Location that should be used to</span></span><br><span class="line">	<span class="comment">// determine the minute, hour, month, day, and year</span></span><br><span class="line">	<span class="comment">// that correspond to this Time.</span></span><br><span class="line">	<span class="comment">// The nil location means UTC.</span></span><br><span class="line">	<span class="comment">// All UTC times are represented with loc==nil, never loc==&amp;utcLoc.</span></span><br><span class="line">	loc *Location <span class="comment">// 时区,在此先不讨论</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于 wall字段这个无符号的64位整型，</p>
<ul>
<li><p>第一位：为0或1，表征是否有单调时钟（如果是time.Now等生成的有该属性，而若是通过字符串转换过来的则没有）</p>
</li>
<li><p>中间的33位：</p>
</li>
</ul>
<p>如果单调时钟标识位为0，则这33位都是0；ext字段是距离<code>Jan 1 year 1</code>的<em>秒数</em>；</p>
<p>如果单调时钟标识位为1，则这33位是距离<code>Jan 1 year 1885</code>的秒数，ext是自从程序启动的<em>纳秒数</em></p>
<ul>
<li>最后30位：精确到的纳秒</li>
</ul>
<p><br></p>
<font size="1" color="grey"><br><br>- 为什么是1885年1月1号？是因为33位的精度正好到这个点么？<br><br>并不是..详细可参考 <a href="https://dashen.tech/2021/08/16/Go%E4%B8%AD%E7%9A%84%E2%80%9C%E9%AD%94%E6%95%B0%E2%80%9D/" target="_blank" rel="noopener">Go中的“魔数”</a><br><br><br>- 第1年1月1日，第一感觉：为什么不是第0年1月1日？<br><br>搜了下，我们现在通用的这套<a href="https://zh.m.wikipedia.org/zh-hans/%E5%85%AC%E5%85%83" target="_blank" rel="noopener">公元纪年法</a>，没有<a href="https://zh.m.wikipedia.org/zh-hans/0%E5%B9%B4" target="_blank" rel="noopener">公元0年</a>，公元后从1年开始。…所以2000年严格来说其实并不是新千禧年的开始，2001年才是。<br><br></font>




<p><br></p>
<p><br></p>
<h3 id="time-Now"><a href="#time-Now" class="headerlink" title="time.Now"></a>time.Now</h3><p><br></p>
<p>而后看下<code>time.Now</code>的实现，</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Monotonic times are reported as offsets from startNano.</span></span><br><span class="line"><span class="comment">// We initialize startNano to runtimeNano() - 1 so that on systems where</span></span><br><span class="line"><span class="comment">// monotonic time resolution is fairly low (e.g. Windows 2008</span></span><br><span class="line"><span class="comment">// which appears to have a default resolution of 15ms),</span></span><br><span class="line"><span class="comment">// we avoid ever reporting a monotonic time of 0.</span></span><br><span class="line"><span class="comment">// (Callers may want to use 0 as "time not set".)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 单调时间报告为与 startNano 的偏移量。我们将 startNano 初始化为 runtimeNano() - 1，以便在单调时间分辨率相当低的系统上（例如，Windows 2008 的默认分辨率似乎为 15 毫秒），我们避免报告单调时间 时间为 0。（调用者可能希望使用 0 作为“未设置时间”。）</span></span><br><span class="line"><span class="keyword">var</span> startNano <span class="keyword">int64</span> = runtimeNano() - <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Now returns the current local time.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Now</span><span class="params">()</span> <span class="title">Time</span></span> &#123;</span><br><span class="line">	sec, nsec, mono := now()</span><br><span class="line">	mono -= startNano</span><br><span class="line">	sec += unixToInternal - minWall</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">uint64</span>(sec)&gt;&gt;<span class="number">33</span> != <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Time&#123;<span class="keyword">uint64</span>(nsec), sec + minWall, Local&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Time&#123;hasMonotonic | <span class="keyword">uint64</span>(sec)&lt;&lt;nsecShift | <span class="keyword">uint64</span>(nsec), mono, Local&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 <code>now()</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Provided by package runtime.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">now</span><span class="params">()</span> <span class="params">(sec <span class="keyword">int64</span>, nsec <span class="keyword">int32</span>, mono <span class="keyword">int64</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>和<a href="https://dashen.tech/2021/05/23/go-linkname/" target="_blank" rel="noopener">go:linkname</a>中提到的<code>func Sleep(d Duration)</code>一样，具体实现在runtime包中的<a href>runtime/timestub.go</a>文件中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> runtime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> _ <span class="string">"unsafe"</span> <span class="comment">// for go:linkname</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//go:linkname time_now time.now</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">time_now</span><span class="params">()</span> <span class="params">(sec <span class="keyword">int64</span>, nsec <span class="keyword">int32</span>, mono <span class="keyword">int64</span>)</span></span> &#123;</span><br><span class="line">	sec, nsec = walltime()</span><br><span class="line">	<span class="keyword">return</span> sec, nsec, nanotime()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即调用<code>walltime()</code>,<code>nanotime()</code>,返回当前的秒，纳秒和程序运行开始至今的单调时间(纳秒)</p>
<p><a href>runtime/time_nofake.go</a>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:nosplit</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">nanotime</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> nanotime1()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">walltime</span><span class="params">()</span> <span class="params">(sec <span class="keyword">int64</span>, nsec <span class="keyword">int32</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> walltime1()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>系统调用，对于Mac OS，<br><a href>runtime/sys_darwin.go</a>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//go:nosplit</span></span><br><span class="line"><span class="comment">//go:cgo_unsafe_args</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">nanotime1</span><span class="params">()</span> <span class="title">int64</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> r <span class="keyword">struct</span> &#123;</span><br><span class="line">		t            <span class="keyword">int64</span>  <span class="comment">// raw timer</span></span><br><span class="line">		numer, denom <span class="keyword">uint32</span> <span class="comment">// conversion factors. nanoseconds = t * numer / denom.</span></span><br><span class="line">	&#125;</span><br><span class="line">	libcCall(unsafe.Pointer(funcPC(nanotime_trampoline)), unsafe.Pointer(&amp;r))</span><br><span class="line">	<span class="comment">// Note: Apple seems unconcerned about overflow here. See</span></span><br><span class="line">	<span class="comment">// https://developer.apple.com/library/content/qa/qa1398/_index.html</span></span><br><span class="line">	<span class="comment">// Note also, numer == denom == 1 is common.</span></span><br><span class="line">	t := r.t</span><br><span class="line">	<span class="keyword">if</span> r.numer != <span class="number">1</span> &#123;</span><br><span class="line">		t *= <span class="keyword">int64</span>(r.numer)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> r.denom != <span class="number">1</span> &#123;</span><br><span class="line">		t /= <span class="keyword">int64</span>(r.denom)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">nanotime_trampoline</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//go:nosplit</span></span><br><span class="line"><span class="comment">//go:cgo_unsafe_args</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">walltime1</span><span class="params">()</span> <span class="params">(<span class="keyword">int64</span>, <span class="keyword">int32</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> t timespec</span><br><span class="line">	libcCall(unsafe.Pointer(funcPC(walltime_trampoline)), unsafe.Pointer(&amp;t))</span><br><span class="line">	<span class="keyword">return</span> t.tv_sec, <span class="keyword">int32</span>(t.tv_nsec)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">walltime_trampoline</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
<p>之后是汇编代码，从操作系统中获取时间</p>
<p><a href>runtime/asm_arm64.s</a>:</p>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/6.png" width="100%" height="100%"></p>
<p>以Linux amd64架构来说，<a href>runtime/sys_linux_amd64.s</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// func walltime1() (sec int64, nsec int32)</span></span><br><span class="line"><span class="comment">// non-zero frame-size means bp is saved and restored</span></span><br><span class="line">TEXT runtime·walltime1(SB),NOSPLIT,$<span class="number">16</span><span class="number">-12</span></span><br><span class="line">	<span class="comment">// We don't know how much stack space the VDSO code will need,</span></span><br><span class="line">	<span class="comment">// so switch to g0.</span></span><br><span class="line">	<span class="comment">// In particular, a kernel configured with CONFIG_OPTIMIZE_INLINING=n</span></span><br><span class="line">	<span class="comment">// and hardening can use a full page of stack space in gettime_sym</span></span><br><span class="line">	<span class="comment">// due to stack probes inserted to avoid stack/heap collisions.</span></span><br><span class="line">	<span class="comment">// See issue #20427.</span></span><br><span class="line"></span><br><span class="line">	MOVQ	SP, R12	<span class="comment">// Save old SP; R12 unchanged by C code.</span></span><br><span class="line"></span><br><span class="line">	get_tls(CX)</span><br><span class="line">	MOVQ	g(CX), AX</span><br><span class="line">	MOVQ	g_m(AX), BX <span class="comment">// BX unchanged by C code.</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set vdsoPC and vdsoSP for SIGPROF traceback.</span></span><br><span class="line">	<span class="comment">// Save the old values on stack and restore them on exit,</span></span><br><span class="line">	<span class="comment">// so this function is reentrant.</span></span><br><span class="line">	MOVQ	m_vdsoPC(BX), CX</span><br><span class="line">	MOVQ	m_vdsoSP(BX), DX</span><br><span class="line">	MOVQ	CX, <span class="number">0</span>(SP)</span><br><span class="line">	MOVQ	DX, <span class="number">8</span>(SP)</span><br><span class="line"></span><br><span class="line">	LEAQ	sec+<span class="number">0</span>(FP), DX</span><br><span class="line">	MOVQ	<span class="number">-8</span>(DX), CX</span><br><span class="line">	MOVQ	CX, m_vdsoPC(BX)</span><br><span class="line">	MOVQ	DX, m_vdsoSP(BX)</span><br><span class="line"></span><br><span class="line">	CMPQ	AX, m_curg(BX)	<span class="comment">// Only switch if on curg.</span></span><br><span class="line">	JNE	noswitch</span><br><span class="line"></span><br><span class="line">	MOVQ	m_g0(BX), DX</span><br><span class="line">	MOVQ	(g_sched+gobuf_sp)(DX), SP	<span class="comment">// Set SP to g0 stack</span></span><br><span class="line"></span><br><span class="line">noswitch:</span><br><span class="line">	SUBQ	$<span class="number">16</span>, SP		<span class="comment">// Space for results</span></span><br><span class="line">	ANDQ	$~<span class="number">15</span>, SP	<span class="comment">// Align for C code</span></span><br><span class="line"></span><br><span class="line">	MOVL	$<span class="number">0</span>, DI <span class="comment">// CLOCK_REALTIME</span></span><br><span class="line">	LEAQ	<span class="number">0</span>(SP), SI</span><br><span class="line">	MOVQ	runtime·vdsoClockgettimeSym(SB), AX</span><br><span class="line">	CMPQ	AX, $<span class="number">0</span></span><br><span class="line">	JEQ	fallback</span><br><span class="line">	CALL	AX</span><br><span class="line">ret:</span><br><span class="line">	MOVQ	<span class="number">0</span>(SP), AX	<span class="comment">// sec</span></span><br><span class="line">	MOVQ	<span class="number">8</span>(SP), DX	<span class="comment">// nsec</span></span><br><span class="line">	MOVQ	R12, SP		<span class="comment">// Restore real SP</span></span><br><span class="line">	<span class="comment">// Restore vdsoPC, vdsoSP</span></span><br><span class="line">	<span class="comment">// We don't worry about being signaled between the two stores.</span></span><br><span class="line">	<span class="comment">// If we are not in a signal handler, we'll restore vdsoSP to 0,</span></span><br><span class="line">	<span class="comment">// and no one will care about vdsoPC. If we are in a signal handler,</span></span><br><span class="line">	<span class="comment">// we cannot receive another signal.</span></span><br><span class="line">	MOVQ	<span class="number">8</span>(SP), CX</span><br><span class="line">	MOVQ	CX, m_vdsoSP(BX)</span><br><span class="line">	MOVQ	<span class="number">0</span>(SP), CX</span><br><span class="line">	MOVQ	CX, m_vdsoPC(BX)</span><br><span class="line">	MOVQ	AX, sec+<span class="number">0</span>(FP)</span><br><span class="line">	MOVL	DX, nsec+<span class="number">8</span>(FP)</span><br><span class="line">	RET</span><br><span class="line">fallback:</span><br><span class="line">	MOVQ	$SYS_clock_gettime, AX</span><br><span class="line">	SYSCALL</span><br><span class="line">	JMP ret</span><br><span class="line"></span><br><span class="line"><span class="comment">// func nanotime1() int64</span></span><br><span class="line">TEXT runtime·nanotime1(SB),NOSPLIT,$<span class="number">16</span><span class="number">-8</span></span><br><span class="line">	<span class="comment">// Switch to g0 stack. See comment above in runtime·walltime.</span></span><br><span class="line"></span><br><span class="line">	MOVQ	SP, R12	<span class="comment">// Save old SP; R12 unchanged by C code.</span></span><br><span class="line"></span><br><span class="line">	get_tls(CX)</span><br><span class="line">	MOVQ	g(CX), AX</span><br><span class="line">	MOVQ	g_m(AX), BX <span class="comment">// BX unchanged by C code.</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set vdsoPC and vdsoSP for SIGPROF traceback.</span></span><br><span class="line">	<span class="comment">// Save the old values on stack and restore them on exit,</span></span><br><span class="line">	<span class="comment">// so this function is reentrant.</span></span><br><span class="line">	MOVQ	m_vdsoPC(BX), CX</span><br><span class="line">	MOVQ	m_vdsoSP(BX), DX</span><br><span class="line">	MOVQ	CX, <span class="number">0</span>(SP)</span><br><span class="line">	MOVQ	DX, <span class="number">8</span>(SP)</span><br><span class="line"></span><br><span class="line">	LEAQ	ret+<span class="number">0</span>(FP), DX</span><br><span class="line">	MOVQ	<span class="number">-8</span>(DX), CX</span><br><span class="line">	MOVQ	CX, m_vdsoPC(BX)</span><br><span class="line">	MOVQ	DX, m_vdsoSP(BX)</span><br><span class="line"></span><br><span class="line">	CMPQ	AX, m_curg(BX)	<span class="comment">// Only switch if on curg.</span></span><br><span class="line">	JNE	noswitch</span><br><span class="line"></span><br><span class="line">	MOVQ	m_g0(BX), DX</span><br><span class="line">	MOVQ	(g_sched+gobuf_sp)(DX), SP	<span class="comment">// Set SP to g0 stack</span></span><br><span class="line"></span><br><span class="line">noswitch:</span><br><span class="line">	SUBQ	$<span class="number">16</span>, SP		<span class="comment">// Space for results</span></span><br><span class="line">	ANDQ	$~<span class="number">15</span>, SP	<span class="comment">// Align for C code</span></span><br><span class="line"></span><br><span class="line">	MOVL	$<span class="number">1</span>, DI <span class="comment">// CLOCK_MONOTONIC</span></span><br><span class="line">	LEAQ	<span class="number">0</span>(SP), SI</span><br><span class="line">	MOVQ	runtime·vdsoClockgettimeSym(SB), AX</span><br><span class="line">	CMPQ	AX, $<span class="number">0</span></span><br><span class="line">	JEQ	fallback</span><br><span class="line">	CALL	AX</span><br><span class="line">ret:</span><br><span class="line">	MOVQ	<span class="number">0</span>(SP), AX	<span class="comment">// sec</span></span><br><span class="line">	MOVQ	<span class="number">8</span>(SP), DX	<span class="comment">// nsec</span></span><br><span class="line">	MOVQ	R12, SP		<span class="comment">// Restore real SP</span></span><br><span class="line">	<span class="comment">// Restore vdsoPC, vdsoSP</span></span><br><span class="line">	<span class="comment">// We don't worry about being signaled between the two stores.</span></span><br><span class="line">	<span class="comment">// If we are not in a signal handler, we'll restore vdsoSP to 0,</span></span><br><span class="line">	<span class="comment">// and no one will care about vdsoPC. If we are in a signal handler,</span></span><br><span class="line">	<span class="comment">// we cannot receive another signal.</span></span><br><span class="line">	MOVQ	<span class="number">8</span>(SP), CX</span><br><span class="line">	MOVQ	CX, m_vdsoSP(BX)</span><br><span class="line">	MOVQ	<span class="number">0</span>(SP), CX</span><br><span class="line">	MOVQ	CX, m_vdsoPC(BX)</span><br><span class="line">	<span class="comment">// sec is in AX, nsec in DX</span></span><br><span class="line">	<span class="comment">// return nsec in AX</span></span><br><span class="line">	IMULQ	$<span class="number">1000000000</span>, AX</span><br><span class="line">	ADDQ	DX, AX</span><br><span class="line">	MOVQ	AX, ret+<span class="number">0</span>(FP)</span><br><span class="line">	RET</span><br><span class="line">fallback:</span><br><span class="line">	MOVQ	$SYS_clock_gettime, AX</span><br><span class="line">	SYSCALL</span><br><span class="line">	JMP	ret</span><br></pre></td></tr></table></figure>
<p><a href>runtime/vdso_linux_amd64.go</a>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vdsoLinuxVersion = vdsoVersionKey&#123;<span class="string">"LINUX_2.6"</span>, <span class="number">0x3ae75f6</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> vdsoSymbolKeys = []vdsoSymbolKey&#123;</span><br><span class="line">	&#123;<span class="string">"__vdso_gettimeofday"</span>, <span class="number">0x315ca59</span>, <span class="number">0xb01bca00</span>, &amp;vdsoGettimeofdaySym&#125;,</span><br><span class="line">	&#123;<span class="string">"__vdso_clock_gettime"</span>, <span class="number">0xd35ec75</span>, <span class="number">0x6e43a318</span>, &amp;vdsoClockgettimeSym&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	vdsoGettimeofdaySym <span class="keyword">uintptr</span></span><br><span class="line">	vdsoClockgettimeSym <span class="keyword">uintptr</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>先通过<em>runtime·vdsoClockgettimeSym</em>拿物理时间，如果拿不到再通过<em>runtime·vdsoGettimeofdaySym</em>拿</p>
<p>而 <em>runtime·vdsoClockgettimeSym</em>对应的系统调用是<strong>gettimeofday</strong></p>
<p><em>runtime·vdsoGettimeofdaySym</em>对应的系统调用是<strong>clock_gettime</strong></p>
<p>关于二者区别，可参考 <a href="https://mp.weixin.qq.com/s/vR051nEEiUs7-gvIXhoZsw" target="_blank" rel="noopener">❲深入理解❳如何精确测量一段代码的执行时间</a></p>
<blockquote>
<p>gettimeofday 获取到的时间精度是微秒（us，10^-6s)。这个函数获得的系统时间是使用墙上时间xtime和jiffies处理得到的。在Linux x86_64系统中，gettimeofday的实现采用了“同时映射一块内存到用户态和内核态，数据由内核态维护，用户态拥有读权限”的方式使得该函数调用不需要陷入内核去获取数据，即Linux x86_64位系统中，这个函数的调用成本和普通的用户态函数基本一致（小于1ms）</p>
</blockquote>
<blockquote>
<p>clock_gettime是 ns（纳秒，10^-9）级别精度的时间获取函数，但需要进入内核态获取</p>
</blockquote>
<p><br></p>
<h3 id="time-Unix"><a href="#time-Unix" class="headerlink" title="time.Unix"></a>time.Unix</h3><p><br></p>
<p>标准库中提供了几个由其他类型转为time.Time类型的方法，如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	t0 := time.Unix(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(t0)</span><br><span class="line"></span><br><span class="line">	t1 := time.Date(<span class="number">2022</span>, <span class="number">07</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">45</span>, time.Local)</span><br><span class="line">	fmt.Println(t1)</span><br><span class="line"></span><br><span class="line">	st, err := time.Parse(<span class="string">"2006-01-02 15:04:05"</span>, <span class="string">"2008-08-08 20:08:00"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(st)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1970</span><span class="number">-01</span><span class="number">-01</span> <span class="number">08</span>:<span class="number">00</span>:<span class="number">00</span> +<span class="number">0800</span> CST</span><br><span class="line"><span class="number">2022</span><span class="number">-07</span><span class="number">-17</span> <span class="number">19</span>:<span class="number">11</span>:<span class="number">23.000000045</span> +<span class="number">0800</span> CST</span><br><span class="line"><span class="number">2008</span><span class="number">-08</span><span class="number">-08</span> <span class="number">20</span>:<span class="number">08</span>:<span class="number">00</span> +<span class="number">0000</span> UTC</span><br></pre></td></tr></table></figure>
<p>其中，<code>time.Parse</code>会在一系列复杂处理后最终再调用<code>time.Date</code>，算是一类</p>
<p>在此暂只分析<code>time.Unix</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Unix returns the local Time corresponding to the given Unix time,</span></span><br><span class="line"><span class="comment">// sec seconds and nsec nanoseconds since January 1, 1970 UTC.</span></span><br><span class="line"><span class="comment">// It is valid to pass nsec outside the range [0, 999999999].</span></span><br><span class="line"><span class="comment">// Not all sec values have a corresponding time value. One such</span></span><br><span class="line"><span class="comment">// value is 1&lt;&lt;63-1 (the largest int64 value).</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  Unix 返回与给定 Unix 时间相对应的本地时间，自 1970 年 1 月 1 日 UTC 以来的秒秒和纳秒纳秒。</span></span><br><span class="line"><span class="comment">//  在 [0, 999999999] 范围之外传递 nsec 是有效的。</span></span><br><span class="line"><span class="comment">//  并非所有秒值都有对应的时间值。 一个这样的值是 1&lt;&lt;63-1（最大的 int64 值）。</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unix</span><span class="params">(sec <span class="keyword">int64</span>, nsec <span class="keyword">int64</span>)</span> <span class="title">Time</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> nsec &lt; <span class="number">0</span> || nsec &gt;= <span class="number">1e9</span> &#123;</span><br><span class="line">		n := nsec / <span class="number">1e9</span></span><br><span class="line">		sec += n</span><br><span class="line">		nsec -= n * <span class="number">1e9</span></span><br><span class="line">		<span class="keyword">if</span> nsec &lt; <span class="number">0</span> &#123;</span><br><span class="line">			nsec += <span class="number">1e9</span></span><br><span class="line">			sec--</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> unixTime(sec, <span class="keyword">int32</span>(nsec))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unixTime</span><span class="params">(sec <span class="keyword">int64</span>, nsec <span class="keyword">int32</span>)</span> <span class="title">Time</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Time&#123;<span class="keyword">uint64</span>(nsec), sec + unixToInternal, Local&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> unixToInternal <span class="keyword">int64</span> = (<span class="number">1969</span>*<span class="number">365</span> + <span class="number">1969</span>/<span class="number">4</span> - <span class="number">1969</span>/<span class="number">100</span> + <span class="number">1969</span>/<span class="number">400</span>) * secondsPerDay <span class="comment">// 即公元1年1月1日的秒数；可参考https://www.zhihu.com/question/320347209； 关于计算两个日期之间的天数，可参考[如何计算两个日期之间的天数]()</span></span><br></pre></td></tr></table></figure>
<p>在<code>func unixTime</code>中因为入参的nsec是int32类型，转为 uint64后，第一个bit位显然为0。</p>
<p>所以之后的 33个bit位 为零，并且ext存储的是 从公元第 1 年 1 月 1 日以来的，完整有符号的 64 位(墙上时钟)秒 。</p>
<p>即对于time.Unix和time.Date/time.Parse来的time是没nanotime()的，因为ext字段没有存</p>
<p>所以如果将最初代码改为：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	start := time.Unix(time.Now().Unix(), <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"start："</span>, start.Unix())</span><br><span class="line">	fmt.Println(<span class="string">"当前墙上时间为："</span>, start.String())</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">10e9</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"在此期间修改系统时间"</span>)</span><br><span class="line"></span><br><span class="line">	end := time.Unix(time.Now().Unix(), <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"end："</span>, end.Unix())</span><br><span class="line">	fmt.Println(<span class="string">"修改系统时间后的墙上时间为："</span>, end.String())</span><br><span class="line"></span><br><span class="line">	elapsed := end.Sub(start)</span><br><span class="line"></span><br><span class="line">	fmt.Println(elapsed)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/7.png" width="100%" height="100%"></p>
<p><br></p>
<h3 id="time-Sub"><a href="#time-Sub" class="headerlink" title="time.Sub"></a>time.Sub</h3><p><br></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hasMonotonic = <span class="number">1</span> &lt;&lt; <span class="number">63</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	minDuration Duration = <span class="number">-1</span> &lt;&lt; <span class="number">63</span></span><br><span class="line">	maxDuration Duration = <span class="number">1</span>&lt;&lt;<span class="number">63</span> - <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Sub returns the duration t-u. If the result exceeds the maximum (or minimum)</span></span><br><span class="line"><span class="comment">// value that can be stored in a Duration, the maximum (or minimum) duration</span></span><br><span class="line"><span class="comment">// will be returned.</span></span><br><span class="line"><span class="comment">// To compute t-d for a duration d, use t.Add(-d).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Time)</span> <span class="title">Sub</span><span class="params">(u Time)</span> <span class="title">Duration</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> t.wall&amp;u.wall&amp;hasMonotonic != <span class="number">0</span> &#123;</span><br><span class="line">		te := t.ext</span><br><span class="line">		ue := u.ext</span><br><span class="line">		d := Duration(te - ue)</span><br><span class="line">		<span class="keyword">if</span> d &lt; <span class="number">0</span> &amp;&amp; te &gt; ue &#123;</span><br><span class="line">			<span class="keyword">return</span> maxDuration <span class="comment">// t - u is positive out of range</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> d &gt; <span class="number">0</span> &amp;&amp; te &lt; ue &#123;</span><br><span class="line">			<span class="keyword">return</span> minDuration <span class="comment">// t - u is negative out of range</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> d</span><br><span class="line">	&#125;</span><br><span class="line">	d := Duration(t.sec()-u.sec())*Second + Duration(t.nsec()-u.nsec())</span><br><span class="line">	<span class="comment">// Check for overflow or underflow.</span></span><br><span class="line">	<span class="keyword">switch</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> u.Add(d).Equal(t):</span><br><span class="line">		<span class="keyword">return</span> d <span class="comment">// d is correct</span></span><br><span class="line">	<span class="keyword">case</span> t.Before(u):</span><br><span class="line">		<span class="keyword">return</span> minDuration <span class="comment">// t - u is negative out of range</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> maxDuration <span class="comment">// t - u is positive out of range</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/8.png" width="100%" height="100%"></p>
<p>而改回最早time.Now的代码，再次debug</p>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/9.png" width="100%" height="100%"></p>
<p>显然进到了if的逻辑块，最后直接 <code>return d</code></p>
<p><img src="/2012/07/17/Wall-Clock与Monotonic-Clock/10.png" width="100%" height="100%"></p>
<p><br></p>
<hr>
<p><br></p>
<h3 id="时间的比较"><a href="#时间的比较" class="headerlink" title="时间的比较"></a>时间的比较</h3><p><br></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	t1 := time.Now()</span><br><span class="line">	t2 := time.Now()</span><br><span class="line">	a := t1 == t2</span><br><span class="line">	fmt.Println(a)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出为 false</p>
<p>看下汇编：</p>
<p> <code>go tool compile -S walltime.go | grep walltime.go:1 | grep -v PCDATA</code></p>
<p>还需要结合分析，隐约知道是先比较wall字段，再比较ext字段</p>
<p><br></p>
<p>参考自 <a href="https://mp.weixin.qq.com/s/wvgc0hQNdBye5C5dkzWyjQ" target="_blank" rel="noopener">Go是如何使用逻辑时钟的？</a></p>
<p>扩展阅读：</p>
<p><a href="https://mp.weixin.qq.com/s/rzBtv174PXE6Jp1fakTGOQ" target="_blank" rel="noopener">Linux内核高精度定时器</a></p>
<p><a href="https://mp.weixin.qq.com/s/XvoH2FUDnNqi8LDx4OwMvQ" target="_blank" rel="noopener">聊一个可能有惊喜的System GC知识点</a> （所以说，Go的玫2分钟的强制GC，是从软件启动后的2分钟，还是墙上的两分钟？比如第0分钟0秒，2分钟0秒，4分钟0秒？）</p>
<p><br></p>
<hr>
<p><br></p>
<h2 id="Rust中的单调时间"><a href="#Rust中的单调时间" class="headerlink" title="Rust中的单调时间"></a>Rust中的单调时间</h2><p><br></p>
<p><a href="https://dashen.tech/2022/01/08/Rust%E6%97%B6%E9%97%B4%E5%92%8C%E6%97%A5%E6%9C%9F/" target="_blank" rel="noopener">Rust时间和日期</a></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::time::&#123;Duration, Instant&#125;;</span><br><span class="line"><span class="keyword">use</span> std::thread::sleep;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">   <span class="keyword">let</span> now = Instant::now();</span><br><span class="line">   sleep(Duration::new(<span class="number">2</span>, <span class="number">0</span>));</span><br><span class="line">   <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, now.elapsed().as_secs());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!--爽哥为赞赏功能新加--></div><!--script(type='text/javascript', src=url_for(theme.js) + '/jquery.js' + '?v=' + theme.version, async)--><script type="text/javascript" src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script><div class="post-donate"><div id="donate_board" class="donate_bar center"><a id="btn_donate" href="javascript:;" title="打赏" class="btn_donate"></a><div class="donate_txt"> &uarr;<br>BTC Address:3NNxkM6ez7szsUAgTnK2VaF949LoGmXuBs<br></div></div><div id="donate_guide" class="donate_bar center hidden pay"><img src="http://cuishuang.gitee.io/img/weChatMoney.png" title="微信打赏" alt="微信打赏"><img src="http://cuishuang.gitee.io/img/alipayMoney.png" title="支付宝打赏" alt="支付宝打赏"><img src="http://cuishuang.gitee.io/img/btc.png" title="比特币打赏" alt="比特币打赏"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div><!-- google adsense--><!--if theme.show_ad_post == true--><!--    script(async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js")--><!--    ins.adsbygoogle(style="display:block" data-ad-client="ca-pub-1181798273731653" data-ad-format="auto")--><!--    script (adsbygoogle = window.adsbygoogle || []).push({});-->
<div class="post-copyright"><blockquote><p>原文作者: fliter</p><p>原文链接: </p><a href="http://www.dashen.tech/2012/07/17/Wall-Clock与Monotonic-Clock/">http://www.dashen.tech/2012/07/17/Wall-Clock与Monotonic-Clock/</a><p>版权声明: 转载请注明出处</p></blockquote></div><div class="tags"><a href="/tags/Go/">Go</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2012/07/17/如何计算两个日期之间的天数/" class="pre">如何计算两个日期之间的天数</a><a href="/2012/07/12/Go-syscall-Getgid/" class="next">Go syscall.Getgid()</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#墙上时钟-vs-单调时钟"><span class="toc-text">墙上时钟 vs 单调时钟</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go中两种时间的实现"><span class="toc-text">Go中两种时间的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Time结构体"><span class="toc-text">Time结构体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time-Now"><span class="toc-text">time.Now</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time-Unix"><span class="toc-text">time.Unix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time-Sub"><span class="toc-text">time.Sub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#时间的比较"><span class="toc-text">时间的比较</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rust中的单调时间"><span class="toc-text">Rust中的单调时间</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/03/25/time-After和select搭配使用时存在的坑/">time.After和select搭配使用时存在的坑</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/20/context-WithCancel-的使用/">context.WithCancel()的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/13/使用govaluate库进行逻辑判断/">使用govaluate库进行逻辑判断</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/03/向前兼容与向后兼容/">向前兼容与向后兼容</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/01/部署Spring-Boot项目/">部署Spring Boot项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/01/新建Spring-Boot项目/">新建Spring Boot项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/29/探究新版本新多出的协程/">探究新版本新多出的协程</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/08/Rust时间和日期/">Rust时间和日期</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/14/OBS推流/">OBS推流</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/14/二进制分析工具/">二进制分析工具</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-weixin"> 扫码关注-旅途散记</i></div><img width="100%" height="233" title="微信扫一扫" src="https://cuishuang.gitee.io/img/lvtusanji.jpg"></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tree/">Tree</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/runtime/">runtime</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sync/">sync</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unit-testing/">unit testing</a><span class="category-list-count">9</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/操作系统/" style="font-size: 15px;">操作系统</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/Todo/" style="font-size: 15px;">Todo</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Pearl/" style="font-size: 15px;">Pearl</a> <a href="/tags/译海一粟/" style="font-size: 15px;">译海一粟</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a> <a href="/tags/Compiler/" style="font-size: 15px;">Compiler</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/密码学/" style="font-size: 15px;">密码学</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/Interview/" style="font-size: 15px;">Interview</a> <a href="/tags/杂谈/" style="font-size: 15px;">杂谈</a> <a href="/tags/金庸/" style="font-size: 15px;">金庸</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/数学/" style="font-size: 15px;">数学</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/Rust/" style="font-size: 15px;">Rust</a> <a href="/tags/explore/" style="font-size: 15px;">explore</a> <a href="/tags/书摘-影评/" style="font-size: 15px;">书摘/影评</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/足球-体育/" style="font-size: 15px;">足球&体育</a> <a href="/tags/读城记/" style="font-size: 15px;">读城记</a> <a href="/tags/星陨/" style="font-size: 15px;">星陨</a> <a href="/tags/奇文共赏/" style="font-size: 15px;">奇文共赏</a> <a href="/tags/区域经济/" style="font-size: 15px;">区域经济</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">四月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">十二月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">七月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">六月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">五月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">四月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">三月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">二月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/01/">一月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">九月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">四月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">三月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1093/02/">二月 1093</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://leetcode.com/" title="LeetCode" target="_blank">LeetCode</a><ul></ul><a href="https://golang.org/" title="Go官网" target="_blank">Go官网</a><ul></ul><a href="https://tonybai.com/" title="TonyBai" target="_blank">TonyBai</a><ul></ul><a href="http://lietoumai.com/" title="顾问麦的小站" target="_blank">顾问麦的小站</a><ul></ul><a href="https://www.coolshell.cn/" title="酷壳" target="_blank">酷壳</a><ul></ul><a href="https://notes.diguage.com/" title="瓜哥" target="_blank">瓜哥</a><ul></ul><a href="https://taoshu.in/" title="涛叔" target="_blank">涛叔</a><ul></ul><a href="https://colobu.com/" title="鸟窝" target="_blank">鸟窝</a><ul></ul><a href="http://xiaorui.cc/" title="峰云" target="_blank">峰云</a><ul></ul><a href="https://eddycjy.com/posts/" title="煎鱼" target="_blank">煎鱼</a><ul></ul><a href="https://hutusi.com/" title="胡涂说" target="_blank">胡涂说</a><ul></ul><a href="https://qcrao.com/" title="码农桃花源" target="_blank">码农桃花源</a><ul></ul><a href="https://github.com/KeKe-Li/For-learning-Go-Tutorial" title="远方的笔记" target="_blank">远方的笔记</a><ul></ul><a href="https://xargin.com/" title="No Headback" target="_blank">No Headback</a><ul></ul><a href="http://thoslin.github.io/" title="Eat Pray Code" target="_blank">Eat Pray Code</a><ul></ul><a href="https://www.ashenone66.cn/" title="AshenOne's Blog" target="_blank">AshenOne's Blog</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> 备案号:<a href="http://www.beian.miit.gov.cn/"> 鲁ICP备18010105号</a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">fliter.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e10d6858b78ff3fc7853fc72e7240eab";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>