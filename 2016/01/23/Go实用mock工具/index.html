<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="崔某人的碎碎念,通才基础上的专才"><meta name="keywords" content="mysql,golang,算法"><title>Go实用mock工具 | 清澄秋爽</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Go实用mock工具</h1><a id="logo" href="/.">清澄秋爽</a><p class="description">苹果树下的思索者 书写是对思维的缓存</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Go实用mock工具</h1><div class="post-meta"><a href="/2016/01/23/Go实用mock工具/#comments" class="comment-count"></a><p><span class="date">Jan 23, 2016</span><span><a href="/categories/unit-testing/" class="category">unit testing</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><blockquote>
<p>单元测试一般不允许有任何外部依赖（文件依赖/网络依赖/数据库依赖等），不会(or不能)在测试代码中去真正 连接数据库/调用api等。这些外部依赖在执行测试时需被模拟(mock/stub)。在测试时，使用模拟的对象来模拟真实依赖下的各种行为。如何运用mock/stub来模拟系统真实行为，算是单元测试道路上的一只拦路虎 <br><br>Mock（模拟）和Stub（桩）是在测试过程中，模拟外部依赖行为的两种常用的技术手段。 通过Mock和Stub我们不仅可以让测试环境没有外部依赖，而且还可以模拟一些异常行为，如数据库服务不可用，没有文件的访问权限等等。<br> –<a href="https://juejin.cn/post/6844903853528186894" target="_blank" rel="noopener">搞定Go单元测试（一）——基础原理</a> 之<strong>利用mock/stub 技术破除外部依赖</strong></p>
</blockquote>
<p>单元测试中只是针对单个函数的测试，关注其内部的逻辑，对于网络/数据库访问等，需要通过相应的手段进行 mock</p>
<p><br></p>
<h3 id="gomock基础用法"><a href="#gomock基础用法" class="headerlink" title="gomock基础用法"></a>gomock基础用法</h3><p><br></p>
<p><a href="https://github.com/golang/mock" target="_blank" rel="noopener">gomock</a> 是Go官方开源的golang测试框架：“GoMock is a mocking framework for the Go programming language”。</p>
<p><img src="/2016/01/23/Go实用mock工具/0.jpeg" width="90%" height="100%"></p>
<p>通过mockgen命令生成包含mock对象的.go文件，其生成的mock对象具备mock+stub的强大功能</p>
<p>安装：</p>
<p><code>go install github.com/golang/mock/mockgen@v1.6.0</code></p>
<font size="1" color="grey"><br><strong>mockgen:</strong><br><br><br>mockgen has two modes of operation: source and reflect.<br><br>Source mode generates mock interfaces from a source file.<br>It is enabled by using the -source flag. Other flags that<br>may be useful in this mode are -imports and -aux_files.<br>Example:<br>        mockgen -source=foo.go [other options]<br><br>Reflect mode generates mock interfaces by building a program<br>that uses reflection to understand interfaces. It is enabled<br>by passing two non-flag arguments: an import path, and a<br>comma-separated list of symbols.<br>Example:<br>        mockgen database/sql/driver Conn,Driver<br><br>  -aux_files string<br>        (source mode) Comma-separated pkg=path pairs of auxiliary Go source files.<br>  -build_flags string<br>        (reflect mode) Additional flags for go build.<br>  -copyright_file string<br>        Copyright file used to add copyright header<br>  -debug_parser<br>        Print out parser results only.<br>  -destination string<br>        Output file; defaults to stdout.<br>  -exec_only string<br>        (reflect mode) If set, execute this reflection program.<br>  -imports string<br>        (source mode) Comma-separated name=path pairs of explicit imports to use.<br>  -mock_names string<br>        Comma-separated interfaceName=mockName pairs of explicit mock names to use. Mock names default to ‘Mock’+ interfaceName suffix.<br>  -package string<br>        Package of the generated code; defaults to the package of the input with a ‘mock_’ prefix.<br>  -prog_only<br>        (reflect mode) Only generate the reflection program; write it to stdout and exit.<br>  -self_package string<br>        The full package import path for the generated code. The purpose of this flag is to prevent import cycles in the generated code by trying to include its own package. This can happen if the mock’s package is set to one of its inputs (usually the main one) and the output is stdio so mockgen cannot detect the final output package. Setting this flag will then tell mockgen which import to exclude.<br>  -source string<br>        (source mode) Input Go source file; enables source mode.<br>  -version<br>        Print version.<br>  -write_package_comment<br>        Writes package documentation comment (godoc) if true. (default true)<br>2017/02/15 10:56:34 Expected exactly two arguments<br><br><br><br><br><br><br>mockgen 有两种操作模式：source 和 reflect。<br><br>源模式从源文件生成模拟接口。<br>它通过使用 -source 标志启用。其他标志<br>在这种模式下可能有用的是 -imports 和 -aux_files。<br>例子：<br>        mockgen -source=foo.go [其他选项]<br><br>Reflect模式通过构建程序生成mock接口<br>使用反射来理解接口。它已启用<br>通过传递两个非标志参数：一个导入路径和一个<br>逗号分隔的符号列表。<br>例子：<br>        mockgen 数据库/sql/driver Conn,Driver<br><br>  - aux_files 字符串<br>        （源模式）逗号分隔的 pkg=辅助 Go 源文件的路径对。<br><br>  - build_flags 字符串<br>        （反射模式）go build 的附加标志。<br>  - copyright_file 字符串<br>        用于添加版权标题的版权文件<br>  - debug_parser<br>        仅打印解析器结果。<br>  - 目标字符串<br>        输出文件;默认为标准输出。<br>  - exec_only 字符串<br>        （反射模式）如果设置，则执行此反射程序。<br>  - 导入字符串<br>        （源模式）逗号分隔的名称=要使用的显式导入的路径对。<br>  - mock_names 字符串<br>        逗号分隔的 interfaceName=mockName 要使用的显式模拟名称对。模拟名称默认为 ‘Mock’+ interfaceName 后缀。<br>  - 包字符串<br>        生成的代码包；默认为带有“mock_”前缀的输入包。<br>  - prog_only<br>        （反射模式）只生成反射程序；将其写入标准输出并退出。<br>  - self_package 字符串<br>        生成代码的完整包导入路径。此标志的目的是通过尝试包含自己的包来防止生成代码中的导入循环。如果将 mock 的包设置为其输入之一（通常是主包）并且输出是 stdio，则可能会发生这种情况，因此 mockgen 无法检测到最终输出包。设置此标志将告诉 mockgen 要排除哪个导入。<br>  - 源字符串<br>        （源模式）输入Go源文件；启用源模式。<br>  - 版本<br>        印刷版。<br>  - write_package_comment<br>        如果为真，则写入包文档注释 (godoc)。 （默认为真）<br><br></font>



<p><br></p>
<p>如对于<em>user.go</em>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="comment">// User 表示一个用户</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserRepository 用户仓库</span></span><br><span class="line"><span class="keyword">type</span> UserRepository <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// FindOne 根据用户id查询得到一个用户或是错误信息</span></span><br><span class="line">	FindOne(id <span class="keyword">int</span>) (*User, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<br><code>mockgen -source user.go -destination user_mock.go -package user</code>，</p>
<p><br></p>
<font size="1"><br><br>- source：指定需要模拟(mock)的接口文件<br><br>- destination：设置生成的mock文件名。若不设置则打印到标准输出中<br><br>- package：设置mock文件的报名。若不设置，则为 mock_前缀加文件名<br><br></font>


<p>之后会在同目录下，生成一个<strong>user_mock.go</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code generated by MockGen. DO NOT EDIT.</span></span><br><span class="line"><span class="comment">// Source: user.go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Package user is a generated GoMock package.</span></span><br><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	reflect <span class="string">"reflect"</span></span><br><span class="line"></span><br><span class="line">	gomock <span class="string">"github.com/golang/mock/gomock"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// MockUserRepository is a mock of UserRepository interface.</span></span><br><span class="line"><span class="keyword">type</span> MockUserRepository <span class="keyword">struct</span> &#123;</span><br><span class="line">	ctrl     *gomock.Controller</span><br><span class="line">	recorder *MockUserRepositoryMockRecorder</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MockUserRepositoryMockRecorder is the mock recorder for MockUserRepository.</span></span><br><span class="line"><span class="keyword">type</span> MockUserRepositoryMockRecorder <span class="keyword">struct</span> &#123;</span><br><span class="line">	mock *MockUserRepository</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewMockUserRepository creates a new mock instance.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMockUserRepository</span><span class="params">(ctrl *gomock.Controller)</span> *<span class="title">MockUserRepository</span></span> &#123;</span><br><span class="line">	mock := &amp;MockUserRepository&#123;ctrl: ctrl&#125;</span><br><span class="line">	mock.recorder = &amp;MockUserRepositoryMockRecorder&#123;mock&#125;</span><br><span class="line">	<span class="keyword">return</span> mock</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// EXPECT returns an object that allows the caller to indicate expected use.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MockUserRepository)</span> <span class="title">EXPECT</span><span class="params">()</span> *<span class="title">MockUserRepositoryMockRecorder</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> m.recorder</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FindOne mocks base method.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MockUserRepository)</span> <span class="title">FindOne</span><span class="params">(id <span class="keyword">int</span>)</span> <span class="params">(*User, error)</span></span> &#123;</span><br><span class="line">	m.ctrl.T.Helper()</span><br><span class="line">	ret := m.ctrl.Call(m, <span class="string">"FindOne"</span>, id)</span><br><span class="line">	ret0, _ := ret[<span class="number">0</span>].(*User)</span><br><span class="line">	ret1, _ := ret[<span class="number">1</span>].(error)</span><br><span class="line">	<span class="keyword">return</span> ret0, ret1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FindOne indicates an expected call of FindOne.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mr *MockUserRepositoryMockRecorder)</span> <span class="title">FindOne</span><span class="params">(id <span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">gomock</span>.<span class="title">Call</span></span> &#123;</span><br><span class="line">	mr.mock.ctrl.T.Helper()</span><br><span class="line">	<span class="keyword">return</span> mr.mock.ctrl.RecordCallWithMethodType(mr.mock, <span class="string">"FindOne"</span>, reflect.TypeOf((*MockUserRepository)(<span class="literal">nil</span>).FindOne), id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>在该目录下新建<strong>user_test.go</strong>文件，来写测试函数</p>
<p><img src="/2016/01/23/Go实用mock工具/1.png" width="90%" height="100%"></p>
<p><br></p>
<h4 id="设置函数的返回值"><a href="#设置函数的返回值" class="headerlink" title="设置函数的返回值"></a>设置函数的返回值</h4><p><br></p>
<p><strong>user_test.go:</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"errors"</span></span><br><span class="line">	<span class="string">"github.com/golang/mock/gomock"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态设置返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReturn</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	ctrl := gomock.NewController(t)</span><br><span class="line">	<span class="keyword">defer</span> ctrl.Finish() <span class="comment">// 在go 1.14+后，如果已将*testing.T对象传入Controller，可以不用主动调用Finish()</span></span><br><span class="line"></span><br><span class="line">	repo := NewMockUserRepository(ctrl)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 期望FindOne(1)返回 Alex</span></span><br><span class="line">	repo.EXPECT().FindOne(<span class="number">1</span>).Return(&amp;User&#123;<span class="string">"Alex"</span>&#125;, <span class="literal">nil</span>)</span><br><span class="line">	<span class="comment">// 期望FindOne(2)返回 Bob</span></span><br><span class="line">	repo.EXPECT().FindOne(<span class="number">2</span>).Return(&amp;User&#123;Name: <span class="string">"Bob"</span>&#125;, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 期望FindOne(3)返回 user not found 的错误</span></span><br><span class="line">	repo.EXPECT().FindOne(<span class="number">3</span>).Return(<span class="literal">nil</span>, errors.New(<span class="string">"user not found"</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 结果验证</span></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">1</span>)) <span class="comment">// &amp;&#123;Alex&#125; &lt;nil&gt;</span></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">2</span>)) <span class="comment">// &amp;&#123;Bob&#125; &lt;nil&gt;</span></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">3</span>)) <span class="comment">// &lt;nil&gt; user not found</span></span><br><span class="line">	<span class="comment">//log.Println(repo.FindOne(4))</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态设置返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReturnDynamic</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	ctrl := gomock.NewController(t)</span><br><span class="line">	<span class="keyword">defer</span> ctrl.Finish()</span><br><span class="line"></span><br><span class="line">	repo := NewMockUserRepository(ctrl)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 常用方法之一：DoAndReturn()，动态设置返回值</span></span><br><span class="line">	repo.EXPECT().FindOne(gomock.Any()).DoAndReturn(<span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="params">(*User, error)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">"user not found"</span>)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> i &lt; <span class="number">100</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> &amp;User&#123;</span><br><span class="line">				Name: <span class="string">"小于100"</span>,</span><br><span class="line">			&#125;, <span class="literal">nil</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> &amp;User&#123;</span><br><span class="line">				Name: <span class="string">"大于等于100"</span>,</span><br><span class="line">			&#125;, <span class="literal">nil</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">126</span>)) <span class="comment">//  &amp;&#123;大于等于100&#125; &lt;nil&gt;</span></span><br><span class="line">	<span class="comment">//log.Println(repo.FindOne(29))</span></span><br><span class="line">	<span class="comment">//log.Println(repo.FindOne(0))</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><img src="/2016/01/23/Go实用mock工具/2.png" width="90%" height="100%"></p>
<p><br></p>
<p>基本使用：</p>
<ol>
<li>首先要把需要 mock 的地方，写成接口（mock 作用的是接口，因此将依赖抽象为接口，而不是直接依赖具体的类）</li>
</ol>
<ol start="2">
<li>执行 mockgen 生成xx_mock.go代码</li>
</ol>
<ol start="3">
<li><p>在单元测试中(xx_test.go)，先执行 <em>ctrl := gomock.NewController(t)</em>, 然后 <em>defer ctrl.Finish()</em></p>
</li>
<li><p>使用 NewMockXXX 生成 mock 对象</p>
</li>
<li><p>调用 EXPECT() 方法，开始设置断言，对于参数，如果输入具体类型，则执行时就要传入相应类型； 如输入 gomock.Any()，则会忽略参数类型(还有 gomock.Eq, gomock.Len, gomock.All等..)</p>
</li>
<li><p>可以通过 Return 设置返回结果</p>
</li>
<li><p>可以通过 Times 设置调用次数( 另外还有 AnyTimes 不限次数，MaxTimes 最多执行次数，MinTimes 最少执行次数)</p>
</li>
</ol>
<ol start="8">
<li>可以通过 After或InOrder 设置执行顺序</li>
</ol>
<p><br></p>
<h4 id="调用次数检测"><a href="#调用次数检测" class="headerlink" title="调用次数检测"></a>调用次数检测</h4><p><br></p>
<p><strong>user_test.go:</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestTimes</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	ctrl := gomock.NewController(t)</span><br><span class="line">	<span class="keyword">defer</span> ctrl.Finish()</span><br><span class="line"></span><br><span class="line">	repo := NewMockUserRepository(ctrl)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 默认期望调用一次</span></span><br><span class="line">	repo.EXPECT().FindOne(<span class="number">222</span>).Return(&amp;User&#123;Name: <span class="string">"Alex"</span>&#125;, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 期望调用两次</span></span><br><span class="line">	repo.EXPECT().FindOne(<span class="number">333</span>).Return(&amp;User&#123;Name: <span class="string">"Bob"</span>&#125;, <span class="literal">nil</span>).Times(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 可以调用任意次(包括0次)</span></span><br><span class="line">	repo.EXPECT().FindOne(<span class="number">666</span>).Return(<span class="literal">nil</span>, errors.New(<span class="string">"出错了"</span>)).AnyTimes()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 验证结果</span></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">222</span>))</span><br><span class="line"></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">333</span>))</span><br><span class="line">	log.Println(repo.FindOne(<span class="number">333</span>)) <span class="comment">// 期望FindOne(333)调用两次，如果注释此行，则测试将不通过. 报错信息为：aborting test due to missing call(s)</span></span><br><span class="line"></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">666</span>)) <span class="comment">//  不限调用次数，注释掉这些行也能通过测试</span></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">666</span>)) <span class="comment">//  不限调用次数，注释掉这些行也能通过测试</span></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">666</span>)) <span class="comment">//  不限调用次数，注释掉这些行也能通过测试</span></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">666</span>)) <span class="comment">//  不限调用次数，注释掉这些行也能通过测试</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="调顺序数检测"><a href="#调顺序数检测" class="headerlink" title="调顺序数检测"></a>调顺序数检测</h4><p><br></p>
<p><strong>user_test.go:</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestOrder</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	ctrl := gomock.NewController(t)</span><br><span class="line">	<span class="keyword">defer</span> ctrl.Finish()</span><br><span class="line"></span><br><span class="line">	repo := NewMockUserRepository(ctrl)</span><br><span class="line"></span><br><span class="line">	o1 := repo.EXPECT().FindOne(<span class="number">222</span>).Return(&amp;User&#123;Name: <span class="string">"Alex"</span>&#125;, <span class="literal">nil</span>)</span><br><span class="line">	o2 := repo.EXPECT().FindOne(<span class="number">333</span>).Return(&amp;User&#123;Name: <span class="string">"Bob"</span>&#125;, <span class="literal">nil</span>)</span><br><span class="line">	o3 := repo.EXPECT().FindOne(<span class="number">666</span>).Return(<span class="literal">nil</span>, errors.New(<span class="string">"出错了"</span>)).AnyTimes()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置调用顺序</span></span><br><span class="line">	gomock.InOrder(o1, o2, o3)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 验证</span></span><br><span class="line">	log.Println(repo.FindOne(<span class="number">222</span>))</span><br><span class="line">	log.Println(repo.FindOne(<span class="number">333</span>))</span><br><span class="line">	log.Println(repo.FindOne(<span class="number">666</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果调整调用顺序，则测试将不能通过</span></span><br><span class="line">	<span class="comment">//log.Println(repo.FindOne(666))</span></span><br><span class="line">	<span class="comment">//log.Println(repo.FindOne(222))</span></span><br><span class="line">	<span class="comment">//log.Println(repo.FindOne(333))</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果不按设置的顺序调用，则会报错：</p>
<p><em>doesn’t match the argument at index 0.</em></p>
<p><em>doesn’t have a prerequisite call satisfied:</em></p>
<p><img src="/2016/01/23/Go实用mock工具/3.png" width="90%" height="100%"></p>
<p><br></p>
<p>内容参考自</p>
<p><a href="https://juejin.cn/post/6844903853532381198" target="_blank" rel="noopener">搞定Go单元测试（二）—— mock框架(gomock)</a></p>
<p><a href="https://jiajunhuang.com/articles/2021_10_12-go_mock.md.html" target="_blank" rel="noopener">使用 gomock 测试 Go 代码</a></p>
<p><br></p>
<p>更多使用技巧，参考 </p>
<p><a href="https://github.com/golang/mock" target="_blank" rel="noopener">文档</a></p>
<p><a href="https://www.google.com.hk/search?newwindow=1&amp;sxsrf=APq-WBvik46nOyHnp9FgZLNvnOrSgY0p7Q:1644822016573&amp;q=gomock%E6%95%99%E7%A8%8B&amp;sa=X&amp;ved=2ahUKEwjkupDAz_71AhUDklYBHQVDD3AQ1QJ6BAgpEAE&amp;biw=1800&amp;bih=994&amp;dpr=1.6" target="_blank" rel="noopener">gomock教程</a></p>
<p><a href="https://coolshell.cn/articles/8209.html" target="_blank" rel="noopener">“单元测试要做多细？”</a></p>
<p><br></p>
<p><a href="https://mp.weixin.qq.com/s/vgzmOGWBL7o-fVd_APoa9g" target="_blank" rel="noopener">Go语言使用：GoMock的基础知识</a></p>
<p><br></p>
<h3 id="gomock其他用法"><a href="#gomock其他用法" class="headerlink" title="gomock其他用法"></a>gomock其他用法</h3><p><br></p>
<p>除去使用<code>mockgen -source=xxx.go</code>，指明从哪个源文件生成,还可以通过<code>mockgen database/sql/driver Conn,Driver</code>指明mock的目标是哪个包的哪些接口</p>
<p><br></p>
<p>另外，还可以 以 <strong>go:generate</strong> 的方式写，然后执行 go generate</p>
<p><em>generate.go:</em><br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:generate mockgen -source=./generate.go -destination mock_generate.go  -package user</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Foo <span class="keyword">interface</span> &#123;</span><br><span class="line">	SayHi(sth <span class="keyword">string</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> foo <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *foo)</span> <span class="title">SayHi</span><span class="params">(sth <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"sth: %s\n"</span>, sth)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	f := foo&#123;&#125;</span><br><span class="line">	f.SayHi(<span class="string">"hi foo"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行<em>go generate</em>后会生成<em>mock_generate.go</em>：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code generated by MockGen. DO NOT EDIT.</span></span><br><span class="line"><span class="comment">// Source: ./generate.go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Package user is a generated GoMock package.</span></span><br><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	reflect <span class="string">"reflect"</span></span><br><span class="line"></span><br><span class="line">	gomock <span class="string">"github.com/golang/mock/gomock"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// MockFoo is a mock of Foo interface.</span></span><br><span class="line"><span class="keyword">type</span> MockFoo <span class="keyword">struct</span> &#123;</span><br><span class="line">	ctrl     *gomock.Controller</span><br><span class="line">	recorder *MockFooMockRecorder</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MockFooMockRecorder is the mock recorder for MockFoo.</span></span><br><span class="line"><span class="keyword">type</span> MockFooMockRecorder <span class="keyword">struct</span> &#123;</span><br><span class="line">	mock *MockFoo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewMockFoo creates a new mock instance.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMockFoo</span><span class="params">(ctrl *gomock.Controller)</span> *<span class="title">MockFoo</span></span> &#123;</span><br><span class="line">	mock := &amp;MockFoo&#123;ctrl: ctrl&#125;</span><br><span class="line">	mock.recorder = &amp;MockFooMockRecorder&#123;mock&#125;</span><br><span class="line">	<span class="keyword">return</span> mock</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// EXPECT returns an object that allows the caller to indicate expected use.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MockFoo)</span> <span class="title">EXPECT</span><span class="params">()</span> *<span class="title">MockFooMockRecorder</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> m.recorder</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SayHi mocks base method.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MockFoo)</span> <span class="title">SayHi</span><span class="params">(sth <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	m.ctrl.T.Helper()</span><br><span class="line">	ret := m.ctrl.Call(m, <span class="string">"SayHi"</span>, sth)</span><br><span class="line">	ret0, _ := ret[<span class="number">0</span>].(error)</span><br><span class="line">	<span class="keyword">return</span> ret0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SayHi indicates an expected call of SayHi.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mr *MockFooMockRecorder)</span> <span class="title">SayHi</span><span class="params">(sth <span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">gomock</span>.<span class="title">Call</span></span> &#123;</span><br><span class="line">	mr.mock.ctrl.T.Helper()</span><br><span class="line">	<span class="keyword">return</span> mr.mock.ctrl.RecordCallWithMethodType(mr.mock, <span class="string">"SayHi"</span>, reflect.TypeOf((*MockFoo)(<span class="literal">nil</span>).SayHi), sth)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="编写可mock的代码"><a href="#编写可mock的代码" class="headerlink" title="编写可mock的代码"></a>编写可mock的代码</h3><p><br></p>
<blockquote>
<p>mock 作用的是接口，因此将依赖抽象为接口，而不是直接依赖具体的类。<br><br>不直接依赖实例，而是使用依赖注入降低耦合。</p>
</blockquote>
<p><br></p>
<p>如果这样写，是无法mock的</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetFromDB</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	db := NewDB()</span><br><span class="line">	<span class="keyword">if</span> value, err := db.Get(key); err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> value</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>而如果将接口 <em>db DB</em> 通过参数传递到 GetFromDB()，那么就可以轻而易举地传入 Mock 对象</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.go</span></span><br><span class="line"><span class="keyword">type</span> DB <span class="keyword">interface</span> &#123;</span><br><span class="line">	Get(key <span class="keyword">string</span>) (<span class="keyword">int</span>, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetFromDB</span><span class="params">(db DB, key <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> value, err := db.Get(key); err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> value</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>参考自：</p>
<p><a href="https://geektutu.com/post/quick-gomock.html" target="_blank" rel="noopener">Go Mock (gomock)简明教程</a></p>
<!--爽哥为赞赏功能新加--></div><!--script(type='text/javascript', src=url_for(theme.js) + '/jquery.js' + '?v=' + theme.version, async)--><script type="text/javascript" src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script><div class="post-donate"><div id="donate_board" class="donate_bar center"><a id="btn_donate" href="javascript:;" title="打赏" class="btn_donate"></a><div class="donate_txt"> &uarr;<br>BTC Address:3NNxkM6ez7szsUAgTnK2VaF949LoGmXuBs<br></div></div><div id="donate_guide" class="donate_bar center hidden pay"><img src="http://cuishuang.gitee.io/img/weChatMoney.png" title="微信打赏" alt="微信打赏"><img src="http://cuishuang.gitee.io/img/alipayMoney.png" title="支付宝打赏" alt="支付宝打赏"><img src="http://cuishuang.gitee.io/img/btc.png" title="比特币打赏" alt="比特币打赏"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div><!-- google adsense--><!--if theme.show_ad_post == true--><!--    script(async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js")--><!--    ins.adsbygoogle(style="display:block" data-ad-client="ca-pub-1181798273731653" data-ad-format="auto")--><!--    script (adsbygoogle = window.adsbygoogle || []).push({});-->
<div class="post-copyright"><blockquote><p>原文作者: fliter</p><p>原文链接: </p><a href="http://www.dashen.tech/2016/01/23/Go实用mock工具/">http://www.dashen.tech/2016/01/23/Go实用mock工具/</a><p>版权声明: 转载请注明出处</p></blockquote></div><div class="tags"><a href="/tags/Tools/">Tools</a><a href="/tags/Go/">Go</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2016/01/25/Docker构建自定义镜像/" class="pre">Docker构建自定义镜像</a><a href="/2016/01/22/增加项目的单元测试覆盖率/" class="next">增加项目的单元测试覆盖率</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#gomock基础用法"><span class="toc-text">gomock基础用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#设置函数的返回值"><span class="toc-text">设置函数的返回值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调用次数检测"><span class="toc-text">调用次数检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#调顺序数检测"><span class="toc-text">调顺序数检测</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gomock其他用法"><span class="toc-text">gomock其他用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写可mock的代码"><span class="toc-text">编写可mock的代码</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/03/13/使用govaluate库进行逻辑判断/">使用govaluate库进行逻辑判断</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/03/向前兼容与向后兼容/">向前兼容与向后兼容</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/01/部署Spring-Boot项目/">部署Spring Boot项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/02/01/新建Spring-Boot项目/">新建Spring Boot项目</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/29/探究新版本新多出的协程/">探究新版本新多出的协程</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/08/Rust时间和日期/">Rust时间和日期</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/14/OBS推流/">OBS推流</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/14/二进制分析工具/">二进制分析工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/12/协程调度顺序/">协程调度顺序</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/11/24/Go内存管理之内存分配/">Go内存管理之内存分配</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-weixin"> 扫码关注-旅途散记</i></div><img width="100%" height="233" title="微信扫一扫" src="https://cuishuang.gitee.io/img/lvtusanji.jpg"></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tree/">Tree</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/runtime/">runtime</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sync/">sync</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/unit-testing/">unit testing</a><span class="category-list-count">9</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/Todo/" style="font-size: 15px;">Todo</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/操作系统/" style="font-size: 15px;">操作系统</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Pearl/" style="font-size: 15px;">Pearl</a> <a href="/tags/译海一粟/" style="font-size: 15px;">译海一粟</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a> <a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/Compiler/" style="font-size: 15px;">Compiler</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/密码学/" style="font-size: 15px;">密码学</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/Interview/" style="font-size: 15px;">Interview</a> <a href="/tags/杂谈/" style="font-size: 15px;">杂谈</a> <a href="/tags/金庸/" style="font-size: 15px;">金庸</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/数学/" style="font-size: 15px;">数学</a> <a href="/tags/Rust/" style="font-size: 15px;">Rust</a> <a href="/tags/explore/" style="font-size: 15px;">explore</a> <a href="/tags/书摘-影评/" style="font-size: 15px;">书摘/影评</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/足球-体育/" style="font-size: 15px;">足球&体育</a> <a href="/tags/读城记/" style="font-size: 15px;">读城记</a> <a href="/tags/星陨/" style="font-size: 15px;">星陨</a> <a href="/tags/奇文共赏/" style="font-size: 15px;">奇文共赏</a> <a href="/tags/区域经济/" style="font-size: 15px;">区域经济</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">十二月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">四月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">十二月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">四月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">三月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">二月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/01/">一月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">九月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">四月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">三月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1093/02/">二月 1093</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://leetcode.com/" title="LeetCode" target="_blank">LeetCode</a><ul></ul><a href="https://golang.org/" title="Go官网" target="_blank">Go官网</a><ul></ul><a href="https://tonybai.com/" title="TonyBai" target="_blank">TonyBai</a><ul></ul><a href="http://lietoumai.com/" title="顾问麦的小站" target="_blank">顾问麦的小站</a><ul></ul><a href="https://www.coolshell.cn/" title="酷壳" target="_blank">酷壳</a><ul></ul><a href="https://notes.diguage.com/" title="瓜哥" target="_blank">瓜哥</a><ul></ul><a href="https://taoshu.in/" title="涛叔" target="_blank">涛叔</a><ul></ul><a href="https://colobu.com/" title="鸟窝" target="_blank">鸟窝</a><ul></ul><a href="http://xiaorui.cc/" title="峰云" target="_blank">峰云</a><ul></ul><a href="https://eddycjy.com/posts/" title="煎鱼" target="_blank">煎鱼</a><ul></ul><a href="https://hutusi.com/" title="胡涂说" target="_blank">胡涂说</a><ul></ul><a href="https://qcrao.com/" title="码农桃花源" target="_blank">码农桃花源</a><ul></ul><a href="https://github.com/KeKe-Li/For-learning-Go-Tutorial" title="远方的笔记" target="_blank">远方的笔记</a><ul></ul><a href="https://xargin.com/" title="No Headback" target="_blank">No Headback</a><ul></ul><a href="http://thoslin.github.io/" title="Eat Pray Code" target="_blank">Eat Pray Code</a><ul></ul><a href="https://www.ashenone66.cn/" title="AshenOne's Blog" target="_blank">AshenOne's Blog</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> 备案号:<a href="http://www.beian.miit.gov.cn/"> 鲁ICP备18010105号</a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">fliter.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e10d6858b78ff3fc7853fc72e7240eab";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>