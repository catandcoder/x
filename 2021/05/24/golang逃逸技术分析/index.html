<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="崔某人的碎碎念,通才基础上的专才"><meta name="keywords" content="mysql,golang,算法"><title>golang逃逸技术分析 | 清澄秋爽</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">golang逃逸技术分析</h1><a id="logo" href="/.">清澄秋爽</a><p class="description">苹果树下的思索者 书写是对思维的缓存</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">golang逃逸技术分析</h1><div class="post-meta"><a href="/2021/05/24/golang逃逸技术分析/#comments" class="comment-count"></a><p><span class="date">May 24, 2021</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><blockquote>
<p>申请到栈内存好处：函数返回直接释放，不会引起垃圾回收，对性能没有影响。<br><br>
申请到堆上面的内存才会引起垃圾回收。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">20</span>)</span><br><span class="line">	b := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">20000</span>)</span><br><span class="line"></span><br><span class="line">	l := <span class="number">20</span></span><br><span class="line">	c := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, l)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>a和b代码一样，就是申请的空间不一样大，但是它们两个的命运是截然相反的。a前面已经介绍过，会申请到栈上面，而b，由于申请的内存较大，编译器会把这种申请内存较大的变量转移到堆上面。即使是临时变量，申请过大也会在堆上面申请。<br><br>
而c，对我们而言其含义和a是一致的，但是编译器对于这种不定长度的申请方式，也会在堆上面申请，即使申请的长度很短。</p>
</blockquote>
<h3 id="font-color-FF69B4-堆-Heap-和栈-Stack-font"><a class="header-anchor" href="#font-color-FF69B4-堆-Heap-和栈-Stack-font">¶</a><font color="#FF69B4">堆(Heap)和栈(Stack)</font></h3>
<br>
<p>参考 <a href="http://www.ruanyifeng.com/blog/2018/01/assembly-language-primer.html" target="_blank" rel="noopener">此文</a> &lt;内存模型：Heap&gt;, &lt;内存模型：Stack&gt;部分的内容:</p>
<p><strong>Heap:</strong></p>
<p>堆的一个重要特点就是不会自动消失，必须手动释放，或者由垃圾回收机制来回收。</p>
<br>
<p><strong>Stack:</strong></p>
<p>栈是由于函数运行而临时占用的内存区域</p>
<p>执行main函数时，会为它在内存里面建立一个帧（frame），所有main的内部变量（比如a和b）都保存在这个帧里面。main函数执行结束后，该帧就会被回收，释放所有的内部变量，不再占用空间。</p>
<p>一般来说，调用栈有多少层，就有多少帧。</p>
<p>所有的帧都存放在 Stack，由于帧是一层层叠加的，所以 Stack 被翻译为<em>栈</em>。 (栈这个字的原始含义,就有栅栏的意思,所谓 栈道,栈桥,都是指比较简陋的用栅栏做的道路/桥梁)</p>
<br>
<p>即 在函数中申请一个新的对象：</p>
<p>如果分配 在栈中，则函数执行结束可自动将内存回收；不会引起垃圾回收，对性能没有影响。</p>
<p>如果分配在堆中，则函数执行结束可交给GC（垃圾回收）处理;如果这个过程（特指垃圾回收不断被触发）过于高频就会导致 gc 压力过大，程序性能出问题。</p>
<br>
<p>C/C++中的new都是分配到堆上,<a href="https://dashen.tech/2017/06/18/golang%E4%B8%ADnew-%E5%92%8Cmake-%E7%9A%84%E5%8C%BA%E5%88%AB/" target="_blank" rel="noopener">Go则不一定(Java亦然)</a></p>
<hr>
<br>
<h3 id="font-color-FF69B4-何为逃逸分析-Escape-analysis-font"><a class="header-anchor" href="#font-color-FF69B4-何为逃逸分析-Escape-analysis-font">¶</a><font color="#FF69B4">何为逃逸分析(Escape analysis)</font></h3>
<br>
<p>在堆上分配的内存,需要GC去回收,而在栈上分配,函数执行完就销毁,不存在垃圾回收的问题. <em>所以应尽可能将内存分配在栈上.</em></p>
<p>但问题是,对于一个函数或变量,并不能知道还有没有其他地方在引用. 所谓的逃逸分析,就是为了确定这个事儿~</p>
 <p class="pbgr">Go编译器会跨越函数和包的边界进行全局的逃逸分析。它会检查是否需要在堆上为一个变量分配内存，还是说可以在栈本身的内存里对其进行管理。</p>
<br>
<hr>
<br>
<h3 id="font-color-FF69B4-何时发生逃逸分析-font"><a class="header-anchor" href="#font-color-FF69B4-何时发生逃逸分析-font">¶</a><font color="#FF69B4">何时发生逃逸分析?</font></h3>
<br>
<blockquote>
<p>Go编译器决定变量应该分配到什么地方时会进行逃逸分析</p>
</blockquote>
<br>
<blockquote>
<p>From a correctness standpoint, you don’t need to know. Each variable in Go exists as long as there are references to it. The storage location chosen by the implementation is irrelevant to the semantics of the language.<br>
<br><br>
The storage location does have an effect on writing efficient programs. When possible, the Go compilers will allocate variables that are local to a function in that function’s stack frame.<br>
<br><br>
However, if the compiler cannot prove that the variable is not referenced after the function returns, then the compiler must allocate the variable on the garbage-collected heap to avoid dangling pointer errors. Also, if a local variable is very large, it might make more sense to store it on the heap rather than the stack.<br>
<br><br>
In the current compilers, if a variable has its address taken, that variable is a candidate for allocation on the heap. However, a basic escape analysis recognizes some cases when such variables will not live past the return from the function and can reside on the stack.</p>
</blockquote>
<br>
<div style="color:#708090;background=#F5FFFA">
<p>Q：如何得知变量是分配在栈（stack）上还是堆（heap）上？</p>
<p>A: 准确地说，你并不需要知道。Golang 中的变量只要被引用就一直会存活，存储在堆上还是栈上由内部实现决定而和具体的语法没有关系。</p>
<p>但知道变量的存储位置确实对程序的效率有帮助。<strong>如果可能，Golang 编译器会将函数的局部变量分配到函数栈帧（stack frame）上。然而，如果编译器不能确保变量在函数 return 之后不再被引用，编译器就会将变量分配到堆上。而且，如果一个局部变量非常大，那么它也应该被分配到堆上而不是栈上。</strong> 当前情况下，如果一个变量被取地址，那么它就有可能被分配到堆上。然而，还要对这些变量做逃逸分析，如果函数 return 之后，变量不再被引用，则将其分配到栈上。</p>
</div>
<br>
<p>可以使用go命令的 <code>-gcflags=&quot;-m&quot;</code>选项，来观察逃逸分析的结果以及GC工具链的<a href="https://dashen.tech/2021/05/22/Go%E4%B8%AD%E7%9A%84%E5%86%85%E8%81%94%E4%BC%98%E5%8C%96/" target="_blank" rel="noopener">内联决策</a> ([内联是一种手动或编译器优化，用于将简短函数的调用替换为函数体本身。这么做的原因是它可以消除函数调用本身的开销，也使得编译器能更高效地执行其他的优化策略。我们可以显式地在函数定义前面加一行<code>//go:noinline</code> 注释让编译器不对函数进行内联)</p>
<br>
<hr>
<br>
<h3 id="font-color-FF69B4-实例-font"><a class="header-anchor" href="#font-color-FF69B4-实例-font">¶</a><font color="#FF69B4">实例</font></h3>
<br>
<p>对于<em>escape1.go</em>代码如下:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Called stackAnalysis"</span>, stackAnalysis())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:noinline</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stackAnalysis</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	data := <span class="number">100</span></span><br><span class="line">	<span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过 <s><code>go build -gcflags &quot;-m -l&quot; escape1.go</code></s>  <code>go build  -gcflags=-m escape1.go</code> 来查看和分析逃逸分析:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./escape1.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">13</span>: inlining call to fmt.Println</span><br><span class="line">./escape1.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">14</span>: <span class="string">"Called stackAnalysis"</span> escapes to heap</span><br><span class="line">./escape1.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">51</span>: stackAnalysis() escapes to heap</span><br><span class="line">./escape1.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">13</span>: []<span class="keyword">interface</span> &#123;&#125;&#123;...&#125; does not escape</span><br><span class="line">&lt;autogenerated&gt;:<span class="number">1</span>: .this does not escape</span><br></pre></td></tr></table></figure>
<p><s><strong>escapes to heap</strong> 即代表该行该处 内存分配发生了逃逸现象. 变量需要在函数栈之间共享(这个例子就是在main和fmt.Println之间在栈上共享)</s></p>
<ul>
<li>
<p>第6行第13个字符处的字符串标量&quot;Called stackAnalysis&quot;逃逸到堆上</p>
</li>
<li>
<p>第6行51个字符处的函数调用stackAnalysis()逃逸到了堆上</p>
</li>
</ul>
<br>
<p>对于<em>escape2.go</em>代码如下:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"Called heapAnalysis"</span>, heapAnalysis())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:noinline</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">heapAnalysis</span><span class="params">()</span> *<span class="title">int</span></span> &#123;</span><br><span class="line">	data := <span class="number">100</span></span><br><span class="line">	<span class="keyword">return</span> &amp;data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>go build  -gcflags=-m escape2.go</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./escape2.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">13</span>: inlining call to fmt.Println</span><br><span class="line">./escape2.<span class="keyword">go</span>:<span class="number">11</span>:<span class="number">2</span>: moved to heap: data</span><br><span class="line">./escape2.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">14</span>: <span class="string">"Called heapAnalysis"</span> escapes to heap</span><br><span class="line">./escape2.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">13</span>: []<span class="keyword">interface</span> &#123;&#125;&#123;...&#125; does not escape</span><br><span class="line">&lt;autogenerated&gt;:<span class="number">1</span>: .this does not escape</span><br></pre></td></tr></table></figure>
<p>函数<em>heapAnalysis</em>返回 int类型的指针,在main函数中会使用该指针变量. 因为是在heapAnalysis函数外部访问,所以data变量必须被移动到堆上</p>
<p>主函数main会从堆中访问该data变量</p>
<p>(可见指针虽能够减少变量在函数间传递时的数据值拷贝,但不该所有类型数据都返回其指针.如果分配到堆上的共享变量太多会增加了GC的压力)</p>
<br>
<hr>
<br>
<h3 id="font-color-FF69B4-逃逸类型-font"><a class="header-anchor" href="#font-color-FF69B4-逃逸类型-font">¶</a><font color="#FF69B4">逃逸类型</font></h3>
<br>
<h4 id="font-color-00FFFF-1-指针逃逸-font"><a class="header-anchor" href="#font-color-00FFFF-1-指针逃逸-font">¶</a><font color="#00FFFF">1. 指针逃逸:</font></h4>
<br>
<p>对于 <strong>escape_a.go</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StudentRegister</span><span class="params">(name <span class="keyword">string</span>, age <span class="keyword">int</span>)</span> *<span class="title">Student</span></span> &#123;</span><br><span class="line">	s := <span class="built_in">new</span>(Student) <span class="comment">//局部变量s逃逸到堆</span></span><br><span class="line"></span><br><span class="line">	s.Name = name</span><br><span class="line">	s.Age = age</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	StudentRegister(<span class="string">"dashen"</span>, <span class="number">18</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br>
<p>执行 <code>go build -gcflags=-m escape_a.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./escape_a.<span class="keyword">go</span>:<span class="number">8</span>:<span class="number">6</span>: can inline StudentRegister</span><br><span class="line">./escape_a.<span class="keyword">go</span>:<span class="number">17</span>:<span class="number">6</span>: can inline main</span><br><span class="line">./escape_a.<span class="keyword">go</span>:<span class="number">18</span>:<span class="number">17</span>: inlining call to StudentRegister</span><br><span class="line">./escape_a.<span class="keyword">go</span>:<span class="number">8</span>:<span class="number">22</span>: leaking param: name</span><br><span class="line">./escape_a.<span class="keyword">go</span>:<span class="number">9</span>:<span class="number">10</span>: <span class="built_in">new</span>(Student) escapes to heap</span><br><span class="line">./escape_a.<span class="keyword">go</span>:<span class="number">18</span>:<span class="number">17</span>: <span class="built_in">new</span>(Student) does not escape</span><br></pre></td></tr></table></figure>
<p>**s 虽然为 函数StudentRegister()内的局部变量, 其值通过函数返回值返回. 但s 本身为指针类型. 所以其指向的内存地址不会是栈而是堆. **</p>
<p>这是一种典型的变量逃逸案例</p>
<br>
<h4 id="font-color-00FFFF-2-栈空间不足而导致的逃逸-空间开辟过大-font"><a class="header-anchor" href="#font-color-00FFFF-2-栈空间不足而导致的逃逸-空间开辟过大-font">¶</a><font color="#00FFFF">2. 栈空间不足而导致的逃逸(空间开辟过大):</font></h4>
<br>
<p>对于 <strong>escape_b.go</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitSlice</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1000</span>, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> index := <span class="keyword">range</span> s &#123;</span><br><span class="line">		s[index] = index</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	InitSlice()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>go build -gcflags=-m escape_b.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">11</span>:<span class="number">6</span>: can inline main</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">4</span>:<span class="number">11</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1000</span>, <span class="number">1000</span>) does not escape</span><br></pre></td></tr></table></figure>
<p>此时并没有发生逃逸</p>
<p>将切片的容量增大10倍,即:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitSlice</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1000</span>, <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> index := <span class="keyword">range</span> s &#123;</span><br><span class="line">		s[index] = index</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	InitSlice()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>go build -gcflags=-m escape_b.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">11</span>:<span class="number">6</span>: can inline main</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">4</span>:<span class="number">11</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1000</span>, <span class="number">10000</span>) escapes to heap</span><br></pre></td></tr></table></figure>
<p>发生了逃逸</p>
<br>
<p><strong>当栈空间不足以存放当前对象,或无法判断当前切片长度时,会将对象分配到堆中</strong></p>
<p>ps:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitSlice</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1000</span>, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> index := <span class="keyword">range</span> s &#123;</span><br><span class="line">		s[index] = index</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">println</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	InitSlice()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>go build -gcflags=-m escape_b.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">12</span>:<span class="number">6</span>: can inline main</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">4</span>:<span class="number">11</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1000</span>, <span class="number">1000</span>) does not escape</span><br></pre></td></tr></table></figure>
<p>没有逃逸.</p>
<p>而改成</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitSlice</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1000</span>, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> index := <span class="keyword">range</span> s &#123;</span><br><span class="line">		s[index] = index</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	InitSlice()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>go build -gcflags=-m escape_b.go</code>,则</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">11</span>:<span class="number">13</span>: inlining call to fmt.Println</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">14</span>:<span class="number">6</span>: can inline main</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">11</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1000</span>, <span class="number">1000</span>) escapes to heap</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">11</span>:<span class="number">13</span>: s escapes to heap</span><br><span class="line">./escape_b.<span class="keyword">go</span>:<span class="number">11</span>:<span class="number">13</span>: []<span class="keyword">interface</span> &#123;&#125;&#123;...&#125; does not escape</span><br><span class="line">&lt;autogenerated&gt;:<span class="number">1</span>: .this does not escape</span><br></pre></td></tr></table></figure>
<p>发生了逃逸</p>
<p>这是为何? 参见下文!</p>
<br>
<h4 id="font-color-00FFFF-3-动态类型逃逸-不确定长度大小-font"><a class="header-anchor" href="#font-color-00FFFF-3-动态类型逃逸-不确定长度大小-font">¶</a><font color="#00FFFF">3. 动态类型逃逸(不确定长度大小):</font></h4>
<br>
<p>当函数参数为**interface{}**类型, 如最常用的<code>fmt.Println(a …interface{})</code>, 编译期间很难确定其参数的具体类型,也会产生逃逸</p>
<br>
<p>对于 <strong>escape_c1.go</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := <span class="string">"s会发生逃逸"</span></span><br><span class="line">	fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>go build -gcflags=-m escape_c1.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./escape_c1.<span class="keyword">go</span>:<span class="number">7</span>:<span class="number">13</span>: inlining call to fmt.Println</span><br><span class="line">./escape_c1.<span class="keyword">go</span>:<span class="number">7</span>:<span class="number">13</span>: s escapes to heap</span><br><span class="line">./escape_c1.<span class="keyword">go</span>:<span class="number">7</span>:<span class="number">13</span>: []<span class="keyword">interface</span> &#123;&#125;&#123;...&#125; does not escape</span><br><span class="line">&lt;autogenerated&gt;:<span class="number">1</span>: .this does not escape</span><br></pre></td></tr></table></figure>
<br>
<p>对于 <strong>escape_c1.go</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	InitSlice2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitSlice2</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">20</span>)    <span class="comment">// 栈 空间小</span></span><br><span class="line">	b := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">20000</span>) <span class="comment">// 堆 空间过大 逃逸</span></span><br><span class="line"></span><br><span class="line">	l := <span class="number">20</span></span><br><span class="line">	c := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, l) <span class="comment">// 堆 动态分配不定空间 逃逸</span></span><br><span class="line"></span><br><span class="line">	_, _, _ = a, b, c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>go build -gcflags=-m escape_c2.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./escape_c2.<span class="keyword">go</span>:<span class="number">7</span>:<span class="number">6</span>: can inline InitSlice2</span><br><span class="line">./escape_c2.<span class="keyword">go</span>:<span class="number">3</span>:<span class="number">6</span>: can inline main</span><br><span class="line">./escape_c2.<span class="keyword">go</span>:<span class="number">4</span>:<span class="number">12</span>: inlining call to InitSlice2</span><br><span class="line">./escape_c2.<span class="keyword">go</span>:<span class="number">4</span>:<span class="number">12</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">20</span>) does not escape</span><br><span class="line">./escape_c2.<span class="keyword">go</span>:<span class="number">4</span>:<span class="number">12</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">20000</span>) escapes to heap</span><br><span class="line">./escape_c2.<span class="keyword">go</span>:<span class="number">4</span>:<span class="number">12</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, l) escapes to heap</span><br><span class="line">./escape_c2.<span class="keyword">go</span>:<span class="number">8</span>:<span class="number">11</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">20</span>) does not escape</span><br><span class="line">./escape_c2.<span class="keyword">go</span>:<span class="number">9</span>:<span class="number">11</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">20000</span>) escapes to heap</span><br><span class="line">./escape_c2.<span class="keyword">go</span>:<span class="number">12</span>:<span class="number">11</span>: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, l) escapes to heap</span><br></pre></td></tr></table></figure>
<br>
<h4 id="font-color-00FFFF-4-闭包引用对象逃逸-font"><a class="header-anchor" href="#font-color-00FFFF-4-闭包引用对象逃逸-font">¶</a><font color="#00FFFF">4. 闭包引用对象逃逸:</font></h4>
<br>
<p>对于如下斐波那契数列<strong>escape_d.go</strong>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fibonacci</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	a, b := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		a, b = b, a+b</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	f := Fibonacci()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"Fibonacci: %d\n"</span>, f())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>go build -gcflags=-m escape_d.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./escape_d.<span class="keyword">go</span>:<span class="number">7</span>:<span class="number">9</span>: can inline Fibonacci.func1</span><br><span class="line">./escape_d.<span class="keyword">go</span>:<span class="number">17</span>:<span class="number">13</span>: inlining call to fmt.Printf</span><br><span class="line">./escape_d.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">2</span>: moved to heap: a</span><br><span class="line">./escape_d.<span class="keyword">go</span>:<span class="number">6</span>:<span class="number">5</span>: moved to heap: b</span><br><span class="line">./escape_d.<span class="keyword">go</span>:<span class="number">7</span>:<span class="number">9</span>: <span class="function"><span class="keyword">func</span> <span class="title">literal</span> <span class="title">escapes</span> <span class="title">to</span> <span class="title">heap</span></span></span><br><span class="line">./escape_d.<span class="keyword">go</span>:<span class="number">17</span>:<span class="number">34</span>: f() escapes to heap</span><br><span class="line">./escape_d.<span class="keyword">go</span>:<span class="number">17</span>:<span class="number">13</span>: []<span class="keyword">interface</span> &#123;&#125;&#123;...&#125; does not escape</span><br><span class="line">&lt;autogenerated&gt;:<span class="number">1</span>: .this does not escape</span><br></pre></td></tr></table></figure>
<br>
<p><em>Fibonacci()函数</em>中原本属于局部变量的a和b,由于闭包的引用,不得不将二者放到堆上,从而产生逃逸</p>
<br>
<hr>
<br>
<h3 id="font-color-FF69B4-总结-font"><a class="header-anchor" href="#font-color-FF69B4-总结-font">¶</a><font color="#FF69B4">总结</font></h3>
<br>
<ul>
<li>
<p>逃逸分析在编译阶段完成</p>
</li>
<li>
<p>逃逸分析目的是决定内分配地址是栈还是堆</p>
</li>
<li>
<p>栈上分配内存比在堆中分配内存有更高的效率</p>
</li>
<li>
<p>栈上分配的内存不需要GC处理</p>
</li>
<li>
<p>堆上分配的内存使用完毕会交给GC处理</p>
</li>
</ul>
<br>
<p>通过逃逸分析,不逃逸的对象分配在栈上,当函数返回时就回收了资源,不需gc标记清除,从而减少gc的压力</p>
<p>同时,栈的分配比堆快,性能好(逃逸的局部变量会在堆上分配,而没有发生逃逸的则有编译器在栈上分配)</p>
<p>另外,还可以进行<strong>同步消除</strong>: 如果定义的对象的方法上有同步锁,但在运行时却只有一个线程在访问,此时逃逸分析后的机器码会去掉同步锁运行</p>
<br>
<hr>
<br>
<p>全文参考自:</p>
<p><a href="https://mp.weixin.qq.com/s/eemPstgUB6hq4BumVxBFQA" target="_blank" rel="noopener">Go内存管理之代码的逃逸分析</a></p>
<p><a href="https://www.cnblogs.com/shijingxiang/articles/12200355.html" target="_blank" rel="noopener">Golang内存分配逃逸分析</a></p>
<br>
<p>推荐阅读:</p>
<p><a href="https://mp.weixin.qq.com/s/tddRxcbzC1mB08C62br38Q" target="_blank" rel="noopener">golang如何优化编译、逃逸分析、内联优化</a></p>
<p><a href="https://blog.csdn.net/iechenyb/article/details/80925876" target="_blank" rel="noopener">java逃逸技术分析</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/377397367" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/377397367</a></p>
<!--爽哥为赞赏功能新加--></div><!--script(type='text/javascript', src=url_for(theme.js) + '/jquery.js' + '?v=' + theme.version, async)--><script type="text/javascript" src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script><div class="post-donate"><div id="donate_board" class="donate_bar center"><a id="btn_donate" href="javascript:;" title="打赏" class="btn_donate"></a><div class="donate_txt"> &uarr;<br>BTC Address:3NNxkM6ez7szsUAgTnK2VaF949LoGmXuBs<br></div></div><div id="donate_guide" class="donate_bar center hidden pay"><img src="http://cuishuang.gitee.io/img/weChatMoney.png" title="微信打赏" alt="微信打赏"><img src="http://cuishuang.gitee.io/img/alipayMoney.png" title="支付宝打赏" alt="支付宝打赏"><img src="http://cuishuang.gitee.io/img/btc.png" title="比特币打赏" alt="比特币打赏"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div><!-- google adsense--><!--if theme.show_ad_post == true--><!--    script(async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js")--><!--    ins.adsbygoogle(style="display:block" data-ad-client="ca-pub-1181798273731653" data-ad-format="auto")--><!--    script (adsbygoogle = window.adsbygoogle || []).push({});-->
<div class="post-copyright"><blockquote><p>原文作者: fliter</p><p>原文链接: </p><a href="http://www.dashen.tech/2021/05/24/golang逃逸技术分析/">http://www.dashen.tech/2021/05/24/golang逃逸技术分析/</a><p>版权声明: 转载请注明出处</p></blockquote></div><div class="tags"><a href="/tags/Go/">Go</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2021/05/26/云时代的开发/" class="pre">云时代的开发</a><a href="/2021/05/23/go-linkname/" class="next">go:linkname</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#font-color-FF69B4-堆-Heap-和栈-Stack-font"><span class="toc-text">¶堆(Heap)和栈(Stack)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#font-color-FF69B4-何为逃逸分析-Escape-analysis-font"><span class="toc-text">¶何为逃逸分析(Escape analysis)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#font-color-FF69B4-何时发生逃逸分析-font"><span class="toc-text">¶何时发生逃逸分析?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#font-color-FF69B4-实例-font"><span class="toc-text">¶实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#font-color-FF69B4-逃逸类型-font"><span class="toc-text">¶逃逸类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#font-color-00FFFF-1-指针逃逸-font"><span class="toc-text">¶1. 指针逃逸:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#font-color-00FFFF-2-栈空间不足而导致的逃逸-空间开辟过大-font"><span class="toc-text">¶2. 栈空间不足而导致的逃逸(空间开辟过大):</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#font-color-00FFFF-3-动态类型逃逸-不确定长度大小-font"><span class="toc-text">¶3. 动态类型逃逸(不确定长度大小):</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#font-color-00FFFF-4-闭包引用对象逃逸-font"><span class="toc-text">¶4. 闭包引用对象逃逸:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#font-color-FF69B4-总结-font"><span class="toc-text">¶总结</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/10/08/代码搜索技巧/">代码搜索技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/10/08/hexo安装实用插件/">hexo安装实用插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/25/SubQuery入门指南II/">SubQuery入门指南II</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/25/SubQuery入门指南/">SubQuery入门指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/19/搭建substrate开发环境/">搭建substrate开发环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/18/使用Selenium获取网站信息/">使用Selenium获取网站信息</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/15/Rust-vs-Go-常用语法对比-13/">Rust vs Go:常用语法对比(13)</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/13/Rust-vs-Go-常用语法对比-12/">Rust vs Go:常用语法对比(12)</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/12/Rust-vs-Go-常用语法对比-11/">Rust vs Go:常用语法对比(11)</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/11/Rust-vs-Go-常用语法对比-10/">Rust vs Go:常用语法对比(10)</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-weixin"> 扫码关注-旅途散记</i></div><img width="100%" height="233" title="微信扫一扫" src="https://cuishuang.gitee.io/img/lvtusanji.jpg"></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tree/">Tree</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sync/">sync</a><span class="category-list-count">9</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/操作系统/" style="font-size: 15px;">操作系统</a> <a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Pearl/" style="font-size: 15px;">Pearl</a> <a href="/tags/译海一粟/" style="font-size: 15px;">译海一粟</a> <a href="/tags/Tools/" style="font-size: 15px;">Tools</a> <a href="/tags/Go/" style="font-size: 15px;">Go</a> <a href="/tags/Todo/" style="font-size: 15px;">Todo</a> <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/Compiler/" style="font-size: 15px;">Compiler</a> <a href="/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/tags/密码学/" style="font-size: 15px;">密码学</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/杂谈/" style="font-size: 15px;">杂谈</a> <a href="/tags/Interview/" style="font-size: 15px;">Interview</a> <a href="/tags/金庸/" style="font-size: 15px;">金庸</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/Rust/" style="font-size: 15px;">Rust</a> <a href="/tags/书摘-影评/" style="font-size: 15px;">书摘/影评</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/数学/" style="font-size: 15px;">数学</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/足球-体育/" style="font-size: 15px;">足球&体育</a> <a href="/tags/读城记/" style="font-size: 15px;">读城记</a> <a href="/tags/星陨/" style="font-size: 15px;">星陨</a> <a href="/tags/奇文共赏/" style="font-size: 15px;">奇文共赏</a> <a href="/tags/区域经济/" style="font-size: 15px;">区域经济</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">三月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">四月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">十二月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/01/">一月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">四月 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">三月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1093/02/">二月 1093</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://leetcode.com/" title="LeetCode" target="_blank">LeetCode</a><ul></ul><a href="https://golang.org/" title="Go官网" target="_blank">Go官网</a><ul></ul><a href="https://tonybai.com/" title="TonyBai" target="_blank">TonyBai</a><ul></ul><a href="http://lietoumai.com/" title="顾问麦的小站" target="_blank">顾问麦的小站</a><ul></ul><a href="https://www.coolshell.cn/" title="酷壳" target="_blank">酷壳</a><ul></ul><a href="https://notes.diguage.com/" title="瓜哥" target="_blank">瓜哥</a><ul></ul><a href="https://colobu.com/" title="鸟窝" target="_blank">鸟窝</a><ul></ul><a href="http://xiaorui.cc/" title="峰云" target="_blank">峰云</a><ul></ul><a href="https://eddycjy.com/posts/" title="煎鱼" target="_blank">煎鱼</a><ul></ul><a href="https://hutusi.com/" title="胡涂说" target="_blank">胡涂说</a><ul></ul><a href="https://qcrao.com/" title="码农桃花源" target="_blank">码农桃花源</a><ul></ul><a href="https://github.com/KeKe-Li/For-learning-Go-Tutorial" title="远方的笔记" target="_blank">远方的笔记</a><ul></ul><a href="https://xargin.com/" title="No Headback" target="_blank">No Headback</a><ul></ul><a href="http://thoslin.github.io/" title="Eat Pray Code" target="_blank">Eat Pray Code</a><ul></ul><a href="https://www.ashenone66.cn/" title="AshenOne's Blog" target="_blank">AshenOne's Blog</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> 备案号:<a href="http://www.beian.miit.gov.cn/"> 鲁ICP备18010105号</a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">fliter.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e10d6858b78ff3fc7853fc72e7240eab";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>